# 2025-10-28 進捗
- プロジェクト雛形作成
- DDSP基本ブロックのスケルトンを配置
- ハーモニクス合成をサンプル単位へ更新、位相継続対応
- トーンスタックをRBJ式Low/Peak/Highに差し替え、時変制御に対応
- モデル出力に mid_fc/mid_Q/alpha_a を追加し、アタック/サステインのミックス導入
- MS-STFT + L1 + トランジェント損失を学習へ組み込み

## ダミーデータセット生成の大幅改善

### 実装した機能

#### 1. 演奏表現エフェクト
- **ビブラート**: 音高の周期的な揺らぎ（深さと速度を可変）
- **ピッチベンド**: チョーキング効果（半音/全音のスムーズな音程上昇）
- **スライド**: 音程間の連続的な移動
- **パームミュート**: 音色変化とサステイン短縮

#### 2. 音楽理論・フレーズ構造
- **スケールシステム**: マイナーペンタトニック、ブルース、ナチュラルマイナー
- **コードトーン**: メジャー、マイナー、ドミナント7th等
- **フレーズパターン**: 上昇/下降スケール、アルペジオ、波型、ランダムウォーク
- **モチーフシステム**: 短いメロディックパターンの生成と変奏
- **モチーフ発展**: 繰り返し、移調、反転、逆行、リズム変化
- **フレーズ構造**: 開始-展開-終止の3部構成

#### 3. 演奏スタイル
- **レガート**: 滑らかな音の接続、ピックノイズ抑制
- **スタッカート**: 短く切った演奏
- **リフスタイル**: リズミカルなパターン
- **ミックススタイル**: 上記の組み合わせ

#### 4. リアルな表現
- **セクションごとの密度変化**: イントロ/展開/エンディングで異なる音符密度
- **テクニック確率**: セクションに応じた演奏技法の使い分け
- **タイミング揺らぎ**: スウィングとヒューマナイズ
- **ダイナミクス**: 強拍弱拍を意識したベロシティ変化

### 主な改善点
- 従来: ランダムな音符配置のみ
- 改善後: 音楽理論に基づいた構造化されたフレーズ
- より自然で表現豊かなギター演奏を生成
- 多様なスタイルとテクニックに対応

### テスト結果
- トレーニングデータ: 100サンプル生成完了
- 検証データ: 20サンプル生成完了
- 各サンプル長: 4.0秒
- ピーク値範囲: 0.87-0.89（適切な正規化）
- 生成速度: 約1.5サンプル/秒

### 追加された関数
1. **演奏表現エフェクト**
   - `apply_vibrato()`: ビブラート効果
   - `apply_pitch_bend()`: ピッチベンド（チョーキング）
   - `generate_slide_note()`: スライド音生成
   - `apply_palm_mute()`: パームミュート効果

2. **音楽理論・フレーズ構造**
   - `get_chord_tones()`: コードトーン取得
   - `create_scale_from_root()`: スケール生成
   - `generate_phrase_pattern()`: フレーズパターン生成
   - `generate_motif()`: モチーフ生成
   - `develop_motif()`: モチーフ発展
   - `create_phrase_structure()`: フレーズ構造作成

3. **拡張された既存関数**
   - `generate_guitar_note()`: 演奏表現パラメータ追加
   - `generate_guitar_phrase()`: 完全リライト、音楽的構造を統合

---

### 2025-10-28 ブルース/ロック拡張の実装

- インターフェース拡張: `generate_guitar_phrase(duration, sample_rate, style='blues_rock', bpm=None, key='E', seed=None, enable_legacy=False)` を追加。
- 旧ロジックを `legacy_generate_guitar_phrase` として分離し、`enable_legacy=True` で切替可能に。
- コード進行: `schedule_blues_regions()` を実装し、12小節ブルース(I7/IV7/V7)から時間長に応じた区間を割当。
- リズム: `make_shuffle_grid()` を追加し、三連系シャッフル(2:1)のタイミング/長さを近似導入。
- ピッチ選択: `sample_chord_aware_pitch()` を実装し、dominant7 のコードトーン重みとブルーノート(b5)を反映。
- オーナメント/テクニック:
  - `render_hopo()`（ハンマリング/プリング）、`render_double_stop()`（ダブルストップ）、`render_prebend_release()`（プレベンド・リリース）を追加。
  - テクニック確率をブルース/ロック向けに最適化（bend/vibrato増強、double/hopo/prebendを少量）。
- 終止: セクション終端でトニックへ軽いカデンツで解決を挿入。
- 互換性: CLIは従来どおり。デフォルトで新スタイルが使われ、必要ならコード側で `enable_legacy=True` を指定。